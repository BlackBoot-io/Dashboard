import { Spin } from "antd";
import routes from "config/routes";
import config from "config/settings";
import { useEffect, useState } from "react";
import { useTranslation } from "react-i18next";
import { useSelector } from "react-redux";
import { useNavigate } from "react-router-dom";
const Crowdsale = ({ current, allSales, loading }) => {
  const { t } = useTranslation();
  const [prevSale, setPrevSale] = useState(null);
  const nav = useNavigate();
  const { lightMode } = useSelector((x) => x.theme);
  useEffect(() => {
    if (loading || !current || !allSales) return;
    const sortedSales = [...allSales].sort(function (a, b) {
      return new Date(a.from).getTime() - new Date(b.from).getTime();
    });
    const idx = sortedSales.findIndex(
      (x) => x.crowdSaleScheduleId === current.crowdSaleScheduleId
    );
    setPrevSale(idx > 0 ? sortedSales[idx - 1] : null);
  }, [allSales, current]);

  const dashes = (revers) => (
    <span className="dashes">
      {(revers ? [4, 3, 2, 1] : [1, 2, 3, 4]).map((x) => (
        <span className={`dash dash-${x}`} key={x}></span>
      ))}
    </span>
  );
  return (
    <div
      id="crowdsale"
      className={`crowsale custom-card with-bg ${loading ? "center" : ""}`}
    >
      {loading ? (
        <Spin />
      ) : (
        <>
          <div className="remain-head">
            <svg
              width="21"
              height="20"
              viewBox="0 0 21 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M10.5629 18.7509C14.8129 18.7511 18.472 15.8064 19.3048 11.7156C20.1377 7.62479 17.9126 3.52577 13.9889 1.92271C10.0653 0.319657 5.53437 1.65842 3.16421 5.12112C0.79406 8.58382 1.2439 13.2074 4.23891 16.1671C5.91221 17.8207 8.18846 18.7507 10.5629 18.7509Z"
                stroke="#949494"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
              <path
                d="M9.17612 7.70459V11.9696H13.3365"
                stroke="#949494"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </svg>
            <h4 className="sec-title">{t("remainingTime")}</h4>
            <span className="remain-time">
              {Math.abs(current?.periodDay)} {t("days")}
            </span>
          </div>
          <ul className="sales">
            {prevSale ? (
              <li className="sale prev">
                <h5 className="hx">
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 18 18"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <circle cx="9" cy="9" r="5" fill="#FE8359" />
                  </svg>
                  <span className="border-throw">{prevSale.title}</span>
                </h5>
                <div className="goal">
                  <label className="from">
                    1<span>{config.tokenName}</span>
                  </label>
                  {dashes(true)}
                  <svg
                    width="20"
                    height="19"
                    viewBox="0 0 20 19"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M5.30815 10.0441C5.60862 10.3292 6.08333 10.3167 6.36844 10.0163C6.65355 9.71578 6.6411 9.24107 6.34062 8.95596L5.30815 10.0441ZM1.88351 4.72679C1.58304 4.44168 1.10833 4.45414 0.82322 4.75462C0.538111 5.05509 0.550568 5.5298 0.851043 5.81491L1.88351 4.72679ZM1.36728 4.52085C0.953065 4.52085 0.617279 4.85664 0.617279 5.27085C0.617279 5.68507 0.953065 6.02085 1.36728 6.02085V4.52085ZM19.1957 6.02085C19.6099 6.02085 19.9457 5.68507 19.9457 5.27085C19.9457 4.85664 19.6099 4.52085 19.1957 4.52085V6.02085ZM0.851043 4.72679C0.550568 5.0119 0.538111 5.48661 0.82322 5.78709C1.10833 6.08756 1.58304 6.10002 1.88351 5.81491L0.851043 4.72679ZM6.34062 1.58575C6.6411 1.30064 6.65355 0.825927 6.36844 0.525451C6.08333 0.224975 5.60862 0.212519 5.30815 0.497628L6.34062 1.58575ZM15.2548 8.95596C14.9544 8.67085 14.4796 8.68331 14.1945 8.98379C13.9094 9.28426 13.9219 9.75897 14.2224 10.0441L15.2548 8.95596ZM18.6795 14.2732C18.9799 14.5584 19.4546 14.5459 19.7398 14.2454C20.0249 13.9449 20.0124 13.4702 19.7119 13.1851L18.6795 14.2732ZM19.1957 14.4792C19.6099 14.4792 19.9457 14.1434 19.9457 13.7292C19.9457 13.315 19.6099 12.9792 19.1957 12.9792V14.4792ZM1.36728 12.9792C0.953065 12.9792 0.617279 13.315 0.617279 13.7292C0.617279 14.1434 0.953065 14.4792 1.36728 14.4792V12.9792ZM19.7119 14.2732C20.0124 13.9881 20.0249 13.5134 19.7398 13.213C19.4546 12.9125 18.9799 12.9 18.6795 13.1851L19.7119 14.2732ZM14.2224 17.4143C13.9219 17.6994 13.9094 18.1741 14.1945 18.4746C14.4796 18.7751 14.9544 18.7875 15.2548 18.5024L14.2224 17.4143ZM6.34062 8.95596L1.88351 4.72679L0.851043 5.81491L5.30815 10.0441L6.34062 8.95596ZM1.36728 6.02085H19.1957V4.52085H1.36728V6.02085ZM1.88351 5.81491L6.34062 1.58575L5.30815 0.497628L0.851043 4.72679L1.88351 5.81491ZM14.2224 10.0441L18.6795 14.2732L19.7119 13.1851L15.2548 8.95596L14.2224 10.0441ZM19.1957 12.9792H1.36728V14.4792H19.1957V12.9792ZM18.6795 13.1851L14.2224 17.4143L15.2548 18.5024L19.7119 14.2732L18.6795 13.1851Z"
                      fill="#BFC1C8"
                    />
                  </svg>
                  {dashes()}
                  <label className="to">
                    {prevSale.price}
                    <span>USDT</span>
                  </label>
                </div>
              </li>
            ) : null}
            {current ? (
              <li className="sale current">
                <h5 className="hx">
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 18 18"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <circle cx="9" cy="9" r="9" fill="#16D359" />
                    <circle cx="9" cy="9" r="7" fill="#18A84B" />
                    <circle cx="9" cy="9" r="5" fill="#007542" />
                  </svg>

                  <span>{current?.title}</span>
                </h5>
                <div className="goal">
                  <label className="from">
                    1<span>{config.tokenName}</span>
                  </label>
                  {dashes(true)}
                  <svg
                    width="20"
                    height="19"
                    viewBox="0 0 20 19"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M5.30815 10.0441C5.60862 10.3292 6.08333 10.3167 6.36844 10.0163C6.65355 9.71578 6.6411 9.24107 6.34062 8.95596L5.30815 10.0441ZM1.88351 4.72679C1.58304 4.44168 1.10833 4.45414 0.82322 4.75462C0.538111 5.05509 0.550568 5.5298 0.851043 5.81491L1.88351 4.72679ZM1.36728 4.52085C0.953065 4.52085 0.617279 4.85664 0.617279 5.27085C0.617279 5.68507 0.953065 6.02085 1.36728 6.02085V4.52085ZM19.1957 6.02085C19.6099 6.02085 19.9457 5.68507 19.9457 5.27085C19.9457 4.85664 19.6099 4.52085 19.1957 4.52085V6.02085ZM0.851043 4.72679C0.550568 5.0119 0.538111 5.48661 0.82322 5.78709C1.10833 6.08756 1.58304 6.10002 1.88351 5.81491L0.851043 4.72679ZM6.34062 1.58575C6.6411 1.30064 6.65355 0.825927 6.36844 0.525451C6.08333 0.224975 5.60862 0.212519 5.30815 0.497628L6.34062 1.58575ZM15.2548 8.95596C14.9544 8.67085 14.4796 8.68331 14.1945 8.98379C13.9094 9.28426 13.9219 9.75897 14.2224 10.0441L15.2548 8.95596ZM18.6795 14.2732C18.9799 14.5584 19.4546 14.5459 19.7398 14.2454C20.0249 13.9449 20.0124 13.4702 19.7119 13.1851L18.6795 14.2732ZM19.1957 14.4792C19.6099 14.4792 19.9457 14.1434 19.9457 13.7292C19.9457 13.315 19.6099 12.9792 19.1957 12.9792V14.4792ZM1.36728 12.9792C0.953065 12.9792 0.617279 13.315 0.617279 13.7292C0.617279 14.1434 0.953065 14.4792 1.36728 14.4792V12.9792ZM19.7119 14.2732C20.0124 13.9881 20.0249 13.5134 19.7398 13.213C19.4546 12.9125 18.9799 12.9 18.6795 13.1851L19.7119 14.2732ZM14.2224 17.4143C13.9219 17.6994 13.9094 18.1741 14.1945 18.4746C14.4796 18.7751 14.9544 18.7875 15.2548 18.5024L14.2224 17.4143ZM6.34062 8.95596L1.88351 4.72679L0.851043 5.81491L5.30815 10.0441L6.34062 8.95596ZM1.36728 6.02085H19.1957V4.52085H1.36728V6.02085ZM1.88351 5.81491L6.34062 1.58575L5.30815 0.497628L0.851043 4.72679L1.88351 5.81491ZM14.2224 10.0441L18.6795 14.2732L19.7119 13.1851L15.2548 8.95596L14.2224 10.0441ZM19.1957 12.9792H1.36728V14.4792H19.1957V12.9792ZM18.6795 13.1851L14.2224 17.4143L15.2548 18.5024L19.7119 14.2732L18.6795 13.1851Z"
                      fill="black"
                    />
                  </svg>
                  {dashes()}
                  <label className="to">
                    {current.price}
                    <span>USDT</span>
                  </label>
                </div>
              </li>
            ) : null}
          </ul>
          <div className="action">
            <div className="min-buy">
              <label>
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M17.0525 15.0787V13.4012C17.0525 12.9858 17.2206 12.5875 17.5198 12.2937L18.7284 11.1075C19.3515 10.4958 19.3515 9.50414 18.7284 8.89249L17.5198 7.70624C17.2206 7.41251 17.0525 7.01413 17.0525 6.59874V4.91999C17.0525 4.05497 16.3381 3.35374 15.4568 3.35374H13.7466C13.3234 3.35373 12.9175 3.18872 12.6183 2.89499L11.4098 1.70874C10.7867 1.09709 9.77636 1.09709 9.15322 1.70874L7.94471 2.89499C7.64547 3.18872 7.23962 3.35373 6.81643 3.35374H5.10617C4.68276 3.35374 4.27671 3.51892 3.97743 3.81292C3.67815 4.10692 3.51019 4.50563 3.51053 4.92124V6.59874C3.51052 7.01413 3.34241 7.41251 3.04317 7.70624L1.83466 8.89249C1.21153 9.50414 1.21153 10.4958 1.83466 11.1075L3.04317 12.2937C3.34241 12.5875 3.51052 12.9858 3.51053 13.4012V15.0787C3.51053 15.9438 4.22492 16.645 5.10617 16.645H6.81643C7.23962 16.645 7.64547 16.81 7.94471 17.1037L9.15322 18.29C9.77636 18.9016 10.7867 18.9016 11.4098 18.29L12.6183 17.1037C12.9175 16.81 13.3234 16.645 13.7466 16.645H15.4556C15.879 16.6453 16.2852 16.4805 16.5847 16.1867C16.8842 15.8929 17.0525 15.4943 17.0525 15.0787Z"
                    stroke="#C4C4C4"
                    strokeWidth="1.5"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M6.82025 8.30131C6.47022 7.95776 6.3655 7.44107 6.55491 6.99219C6.74433 6.5433 7.19057 6.25061 7.68556 6.25061C8.18055 6.25061 8.62679 6.5433 8.81621 6.99219C9.00562 7.44107 8.9009 7.95776 8.55088 8.30131C8.07296 8.77038 7.29816 8.77038 6.82025 8.30131Z"
                    stroke="#C4C4C4"
                    strokeWidth="1.5"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M12.0121 13.3974C11.6621 13.0539 11.5574 12.5372 11.7468 12.0883C11.9362 11.6394 12.3825 11.3467 12.8775 11.3467C13.3724 11.3467 13.8187 11.6394 14.0081 12.0883C14.1975 12.5372 14.0928 13.0539 13.7428 13.3974C13.2649 13.8665 12.4901 13.8665 12.0121 13.3974Z"
                    stroke="#C4C4C4"
                    strokeWidth="1.5"
                    strokeLinecap="round"
                  />
                  <path
                    d="M13.7428 6.60126L6.81897 13.3988"
                    stroke="#C4C4C4"
                    strokeWidth="1.5"
                    strokeLinecap="round"
                  />
                </svg>
                <span>{t("minimumBuy")}</span>
              </label>
              <span className="min">${current?.minimumBuy}</span>
            </div>
            <button
              onClick={() => nav(`/${routes.buyToken}`)}
              className="btn-primary"
            >
              <svg
                width="19"
                height="17"
                viewBox="0 0 19 17"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M1.47672 6.02483L1.92243 11.8582C2.07653 14.2597 4.09105 16.1385 6.54237 16.1667H13.0224C15.4742 16.1391 17.4894 14.2602 17.6435 11.8582L18.0892 6.02483C18.204 4.74533 17.771 3.47667 16.894 2.52334C16.0171 1.57001 14.7754 1.01808 13.4669 1H6.09785C4.78962 1.0184 3.54824 1.57047 2.67153 2.52377C1.79483 3.47706 1.36194 4.74553 1.47672 6.02483Z"
                  stroke={lightMode ? "white" : "black"}
                  strokeWidth="1.5"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                />
                <path
                  d="M13.3481 5.66669C13.3481 6.91712 12.6685 8.07256 11.5652 8.69778C10.462 9.32299 9.10277 9.32299 7.99955 8.69778C6.89632 8.07256 6.21671 6.91712 6.21671 5.66669"
                  stroke={lightMode ? "white" : "black"}
                  strokeWidth="1.5"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                />
              </svg>

              <span>{t("buyNow")}</span>
            </button>
          </div>
        </>
      )}
    </div>
  );
};
export default Crowdsale;
